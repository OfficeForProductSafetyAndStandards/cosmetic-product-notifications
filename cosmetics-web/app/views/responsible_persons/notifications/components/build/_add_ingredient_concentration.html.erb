<div class="govuk-grid-row">
  <% if model.ingredient_number.present? %>
    <div class="govuk-grid-column-three-quarters">
      <h1 class="govuk-heading-l govuk-!-margin-bottom-3"><%= title %></h1>
    </div>
    <div class="govuk-grid-column-one-quarter govuk-!-margin-bottom-4">
      <div class="opss-text-align-right">
        <%= link_to("Remove this ingredient",
                    responsible_person_notification_component_delete_ingredient_path(@notification.responsible_person, @notification, @component, model.ingredient_number),
                    class: "govuk-link govuk-link--no-visited-state govuk-!-font-size-19 opss-text-underline-offset") %>
      </div>
    </div>
  <% else %>
    <div class="govuk-grid-column-full">
      <h1 class="govuk-heading-l govuk-!-margin-bottom-3"><%= title %></h1>
    </div>
  <% end %>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-three-quarters">
    <%= link_to("Upload ingredients using CSV file",
                responsible_person_notification_component_build_path(@notification.responsible_person, @notification, @component, :upload_ingredients_file),
                class: "govuk-link govuk-link--no-visited-state govuk-!-font-size-19 opss-text-underline-offset") %>
</div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <p class="govuk-body-s opss-secondary-text">Add each ingredient individually. For every ingredient:</p>
    <ul class="govuk-list govuk-list--bullet govuk-!-font-size-16 opss-secondary-text">
      <% unless local_assigns[:poisonous] == true %>
        <li>If it is shown as an ingredient on the product label it must to be added to the notification as an ingredient</li>
      <% end %>
      <li>Use the International Nomenclature of Cosmetic Ingredients (<abbr>INCI</abbr>) name, where available</li>
      <li>Confirm if the ingredient is listed in the National Poisons Information Service (<abbr>NPIS</abbr>) tables and if it is an ingredient the <abbr>NPIS</abbr> needs to know about</li>
    </ul>

    <%= link_to "Skip <abbr>NPIS</abbr> tables.", "#skip-to-form", class: "govuk-skip-link opss-skip-link" %>

    <%= govukDetails(summaryText: "Show the <abbr>NPIS</abbr> tables".html_safe, classes: "govuk-!-margin-left-0") do %>
      <%= render "npis_tables" %>
    <% end %>

    <hr class="govuk-section-break govuk-section-break--visible govuk-!-margin-top-0 govuk-!-margin-bottom-6">

    <%= form_with model: model, scope: :ingredient_concentration_form, url: wizard_path, method: :put, id: "skip-to-form", html: { novalidate: true } do |form| %>
      <div class="govuk-form-group">
        <% number = model.ingredient_number ? (model.ingredient_number + 1) : (component.ingredients.size + 1) %>
        <%= govukFieldset(legend: { text: "Ingredient #{number}", classes: "govuk-fieldset__legend--s" }) do %>
          <%= yield form %>
          <%= form.hidden_field(:ingredient_number, value: model.ingredient_number) if model.ingredient_number.present? %>
        <% end %>
      </div>
      <div class="govuk-button-group">
        <%= govukButton text: "Save and continue" %>
        <% if component.ingredients.any? && model.ingredient_number.blank? %>
          <%= link_to("Skip", wizard_path(:select_ph_option), class: "govuk-link govuk-link--no-visited-state") %>
        <% end %>
      </div>
    <% end %>
  </div>

  <% if component.ingredients.any? %>
    <div class="govuk-grid-column-one-third">
      <h2 class="govuk-heading-s">Already added</h2>

      <ol class="govuk-list govuk-list--number govuk-!-font-size-16 opss-secondary-text">
        <% component.ingredients.each_with_index do |ingredient, index| %>
          <li>
            <% if model.ingredient_number == index %>
              <span class="govuk-!-font-weight-bold">
                <%= ingredient.inci_name %>
              </span>
            <% else %>
              <%= ingredient.inci_name %>
            <% end %>
          </li>
        <% end %>
      </ol>

      <p class="govuk-body-s opss-secondary-text">
        These ingredients have already been added to the <%= component.notification.is_multicomponent? ? "item" : "product" %>.
      </p>
    </div>
  <% end %>
</div>

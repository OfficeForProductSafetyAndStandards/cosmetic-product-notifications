<% title = "Select formulation type" %>
<% question = "How will you provide #{@component_name} formulation?" %>
<% items = formulations_types_label.map { |type_key, type_object| 
  { text: type_object[:text], 
    value: type_key.to_sym, 
    checked: answer_checked?(type_key.to_sym), 
    label: { classes: type_object[:classes] }, 
    wrapper_classes: type_object[:wrapper_classes] } 
} %>

<% page_title title, errors: @component.errors.any? %>
<% content_for :after_header do %>
  <%= govukBackLink text: "Back", href: previous_wizard_path %>
<% end %>

<% warning_html = if @component.notification_type.present?
    govukWarningText(iconFallbackText: "Warning",
                     classes: "govuk-!-width-three-quarters govuk-!-margin-top-3 opss-warning-text--m",
                     text: "Changing the formulation type will remove all ingredients already added")
  end
%>

<%= form_with model: @component, url: wizard_path, method: :put do |form| %>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <%= error_summary_for(@component, first_values: {notification_type: items[0][:value]}) %>
      <%= govukRadios(
            form: form,
            key: :notification_type,
            fieldset: { legend: { text: question, classes: "govuk-fieldset__legend--l", isPageHeading: true } },
            hint: { html:  warning_html },
            items: items,
          ) do %>
          <p class="govuk-body govuk-!-width-three-quarters opss-secondary-text" id="type-hint">
            There are three formulation types: Predefined frame formulations, exact concentrations and concentration ranges. You can enter information manually or by uploading a <abbr title="Comma Separated Values">CSV</abbr> file.
          </p>
          <p class="govuk-body govuk-!-width-three-quarters govuk-!-margin-bottom-8 opss-secondary-text">
            Learn how you can <a href="/help/csv" class="govuk-link govuk-link--no-visited-state" rel="noreferrer noopener" target="_blank">use a <abbr>CSV</abbr> file (opens in a new tab)</a>.
          </p>
        <% end %>
      <%= govukButton text: "Continue" %>
    </div>
  </div>
<% end %>

<% title = "Add the ingredients" %>

<% page_title title, errors: @exact_concentration_form.errors.any? %>
<% content_for :after_header do %>
  <%= govukBackLink text: "Back", href: previous_wizard_path %>
<% end %>

<%= error_summary(@exact_concentration_form.errors) %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <h1 class="govuk-heading-l govuk-!-margin-bottom-3"><%= title %></h1>
  </div>

  <div class="govuk-grid-column-two-thirds">
    <p class="govuk-body-s opss-secondary-text">For every ingredient:</p>
    <ul class="govuk-list govuk-list--bullet govuk-!-font-size-16 opss-secondary-text">
      <li>Use the International Nomenclature of Cosmetic Ingredients (<abbr>INCI</abbr>) name, where available</li>
      <li>Confirm if poisonous - especially if the details match ingredients listed in the following poison tables </li>
    </ul>

    <%= govukDetails(summaryText: "Show the poison tables", classes: "govuk-!-margin-left-0 govuk-!-font-size-16") do %>
      <%= render "poison_tables" %>
    <% end %>

    <hr class="govuk-section-break govuk-section-break--visible govuk-!-margin-top-0 govuk-!-margin-bottom-6">

    <%= form_with model: @exact_concentration_form, scope: :exact_concentration_form, url: wizard_path, method: :put, html: { novalidate: true } do |form| %>
      <div class="govuk-form-group">
        <%= render "components/govuk_fieldset", legend: { text: "Ingredient #{@component.exact_formulas.count + 1}", classes: "govuk-fieldset__legend--s" } do %>
          <%= render "form_components/govuk_input", form: form, id: "name", key: :name, label: { text: "What is the name?" } %>

          <div class="govuk-grid-row">
            <div class="govuk-grid-column-one-half">
              <% concentration_error = @exact_concentration_form.errors[:exact_concentration]&.first %>
              <div class="govuk-form-group <%= "govuk-form-group--error" if concentration_error %>">
                <%= govukLabel(for: :exact_concentration, text: "What is the exact concentration?", classes: "govuk-label--s govuk-!-font-weight-regular")%>
                <% if concentration_error %>
                  <%= render "components/govuk_error_message", id: "exact_concentration-error", text: concentration_error %>
                <% end %>
                <div class="govuk-input__wrapper">
                  <%= form.text_field(:exact_concentration,
                                      id: "exact_concentration",
                                      class: "govuk-input govuk-input--width-3 #{'govuk-input--error' if concentration_error}",
                                      maxlength: 3,
                                      "aria-describedby" => ("exact_concentration-error" if concentration_error)) %>
                  <div class="govuk-input__suffix" aria-hidden="true">
                    <span title="Percentage weight by weight">% w/w</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="govuk-grid-column-one-half">
              <div class="govuk-form-group">
                <div class="govuk-checkboxes opss-float-right-desktop">
                  <%= render "form_components/govuk_input",
                            form: form,
                            key: :cas_number,
                            id: "cas_number",
                            label: { text: "What is the CAS number?", classes: "govuk-label--s govuk-!-font-weight-regular" },
                            classes: "govuk-input--width-10" %>
                </div>
              </div>
            </div>
          </div>

          <div class="govuk-grid-row">
            <div class="govuk-grid-column-one-half">
              <%= render "form_components/govuk_checkboxes",
                        form: form,
                        key: :poisonous_check,
                        id: "poisonous_check",
                        classes: " govuk-!-padding-top-6",
                        items: [{ key: :poisonous,  text: "Is it poisonous?" }] %>
            </div>
          </div>
        <% end %>
      </div>
      <div class="govuk-button-group">
        <%= govukButton text: "Save and continue" %>
        <% if @component.exact_formulas.any? %>
          <%= link_to("Skip", wizard_path(:select_ph_option), class: "govuk-link govuk-link--no-visited-state") %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

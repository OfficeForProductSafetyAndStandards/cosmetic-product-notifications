<% title = "Add the ingredients" %>

<% page_title title, errors: @ingredient_concentration_form.errors.any? %>
<% content_for :after_header do %>
  <%= govukBackLink text: "Back", href: previous_wizard_path %>
<% end %>

<% errors = @ingredient_concentration_form.errors %>
<%= error_summary(errors,
                  %i[name cas_number poisonous exact_concentration range_concentration],
                  map_errors: { range_concentration: ingredient_range_concentration_items.first[:id], poisonous: "poisonous_true" }) %>

<%= render "add_ingredient_concentration", title: title, component: @component, model: @ingredient_concentration_form do |form| %>
  <%= render "form_components/govuk_input", form: form, id: "name", key: :name, label: { text: "What is the name?" } %>
  <%= render "form_components/govuk_input",
             form: form,
             key: :cas_number,
             id: "cas_number",
             label: { text: "What is the CAS number?", classes: "govuk-label--s govuk-!-font-weight-regular" },
             classes: "govuk-input--width-10" %>

  <% exact_concentration_html = capture do %>
    <%= render "exact_concentration_input", model: @ingredient_concentration_form, form: form %>
  <% end %>

  <% range_concentration_html = capture do %>
    <%= render "form_components/govuk_radios",
               form: form,
               key: :range_concentration,
               classes: "govuk-radios--small",
               fieldset: { legend: { text: "What is the concentration range?",
                                     classes: "govuk-fieldset__legend--s govuk-!-font-weight-regular",
                                     isPageHeading: false } },
               items: ingredient_range_concentration_items %>
  <% end %>

  <%= render "form_components/govuk_radios",
             form: form,
             key: :poisonous,
             id: "poisonous",
             fieldset: { legend: { text: "Is it poisonous?",
                                   classes: "govuk-fieldset__legend--s govuk-!-font-weight-regular",
                                   isPageHeading: false } },
             items: [
               { text: "Yes",
                 value: "true",
                 id: "poisonous_true",
                 conditional: { html: exact_concentration_html },
                 checked: errors.include?(:exact_concentration) || @ingredient_concentration_form.poisonous == true },
               { text: "No",
                 value: "false",
                 id: "poisonous_false",
                 conditional: { html: range_concentration_html },
                 checked: errors.include?(:range_concentration) || @ingredient_concentration_form.poisonous == false },
             ] %>
<% end %>

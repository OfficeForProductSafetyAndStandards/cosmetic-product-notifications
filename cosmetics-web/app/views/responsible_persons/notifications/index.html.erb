<% content_for :page_title, "Your cosmetic products" %>
<% content_for :after_header do %>
  <%= render "layouts/navbar" %>
<% end %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-l">Your cosmetic products</h1>

    <% if @registered_notifications.total_entries.zero? %>
      <p><strong><%= @responsible_person.name %></strong> has not submitted any cosmetic product notifications in the UK.</p>

      <p>All cosmetic products sold or given away in the UK must be notified in the UK.</p>

      <p>To continue to sell or give away cosmetic products that were notified to the European Union (EU) before <span class="no-wrap"><%= display_full_month_date EU_EXIT_DATE %></span>, you must submit your product notifications in the UK within 90 days of the UK leaving the EU â€“ that is by <span class="no-wrap"><%= display_full_month_date SUBMISSION_WINDOW_END_DATE %>.</span></p>

    <% end %>
  </div>
</div>


<% if @pending_notification_files_count.positive? %>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <div class="govuk-error-summary loading-spinner__container">
        <h2 class="govuk-error-summary__title">
          <span class="loading-spinner__dot"></span>
          Checking <%= pluralize(@pending_notification_files_count, 'notification file') %>
      </h2>
      <div class="govuk-error-summary__body">
        <%= link_to "Refresh the browser to see uploaded products", url_for, class: "govuk-link--no-visited-state" %>
      </div>
      </div>
    </div>
  </div>
<% end %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full govuk-!-margin-top-4 govuk-!-margin-bottom-6">


    <!-- only shown if there are errors - starts. (And only show errors accordian if there are errors) -->
    <!-- if, in the current functionality we redirect here, we add the second refresh line (url points to self) -->
    <%= render 'errors_banner' if @erroneous_notification_files.present? %>
    <!-- only shown if there are errors - ends -->

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <h1 class="govuk-heading-l govuk-!-margin-bottom-2" aria-describedby="cosmetic-products-hint">
          Cosmetic products
        </h1>
      </div>
      <div class="govuk-grid-column-one-third govuk-!-margin-bottom-2">
        <a href="<%= new_responsible_person_add_notification_path(@responsible_person) %>" class="govuk-link govuk-link--no-visited-state govuk-!-font-size-19 opss-text-align-right opss-text-underline-offset">
          Add a cosmetic product
        </a>
      </div>
    </div>
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
        <p id="cosmetic-products-hint" class="govuk-hint govuk-!-width-two-thirds">
        These are your incomplete and notified cosmetic products.
        </p>
      </div>
    </div>

  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <% if @erroneous_notification_files.present? || @unfinished_notifications.present? %>
      <div class="govuk-accordion opss-accordian__open-remove govuk-!-margin-bottom-0" data-module="govuk-accordion" id="accordion-opss">
        <%= render 'errors' if @erroneous_notification_files.present? %>
        <%= render 'incomplete_notifications' if @unfinished_notifications.present? %>
      </div>
    <% end %>

    <% if @unfinished_notifications.blank? %>
      <div class="opss-border-top govuk-!-padding-top-3 opss-border-bottom">
        <h2 class="govuk-heading-m govuk-!-margin-bottom-2">
          Incomplete notifications (0)
        </h2>
        <p class="govuk-body">
        There are currently no incomplete notifications.
        </p>
      </div>
    <% end %>

    <section role="region" aria-label="Notified products">
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds govuk-!-margin-top-7">
          <h2 class="govuk-heading-m govuk-!-margin-bottom-2">
            Product notifications (<%= @registered_notifications.count %>)
          </h2>
          <p class="govuk-body govuk-!-margin-bottom-0">
          There are currently <%= @registered_notifications.count %> notified cosmetic products.
          </p>
        </div>
        <div class="govuk-grid-column-one-third govuk-!-margin-bottom-2 govuk-!-margin-top-7">

          <% if @registered_notifications.present? %>
            <a href="<%= responsible_person_notifications_path(@responsible_person, format: :csv) %>" class="govuk-link govuk-link--no-visited-state govuk-!-font-size-14 opss-text-align-right" download="">
              <span class="opss-download-link-sm"></span>Download a <abbr title="Comma-Separated Values">CSV</abbr> file of your notified products
            </a>
          <% end %>
        </div>
      </div>

      <%= render 'complete_notifications_table' if @registered_notifications.present? %>

      <%= paginate @registered_notifications, views_prefix: 'pagination' %>

    </section>

  </div>
</div>



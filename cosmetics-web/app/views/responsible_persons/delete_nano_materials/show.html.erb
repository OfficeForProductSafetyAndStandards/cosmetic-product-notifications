<% title = "Remove Nanomaterial" %>
<% question = "Select which nanomaterials to remove" %>

<% page_title title, errors: @form.errors.any? %>
<% content_for :after_header do %>
  <%= govukBackLink text: "Back", href: responsible_person_notification_draft_path(@notification.responsible_person, @notification) %>
<% end %>

<% items = @notification.nano_materials.map(&:nano_elements).flatten.each_with_index.map { |n, i|
  { name: 'notification_wizard_delete_nano_material_form[nano_material_ids][]',
    text: (n.inci_name.present? ? n.inci_name : "Nanomaterial ##{i+1}"),
    value: n.nano_material.id,
    key: :nil, # TODO: investigate design library to get rid of required key attribute
    id: "nano-#{n.id}",
    disable_ghost: true
  }
} %>

<%= form_with model: @form, url: responsible_person_notification_draft_delete_nano_material_path(@notification.responsible_person, @notification), method: :delete do |form| %>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <%= error_summary_for(@form) %>
      <%= render "form_components/govuk_checkboxes",
              form: form,
              key: :component_id,
              classes: "govuk-!-margin-top-7",
              fieldset: { legend: { text: question, classes: "govuk-label--l", isPageHeading: true } },
              items: items,
              hint: { text: 'The selected nanomaterial(s) will be removed and deleted from this draft. If you delete all of them you can add nanomaterials to the draft by completing the first task again.', classes: 'govuk-!-width-three-quarters' } %>
      <div class="govuk-button-group">
        <%= govukButton text: "Delete and continue" %>

        <a class="govuk-link" href="#">Cancel</a>
      </div>
    </div>
  </div>
<% end %>

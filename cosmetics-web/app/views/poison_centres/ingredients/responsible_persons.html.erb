<% content_for :page_title, "Ingredients list" %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full opss-desktop-min-height--s">

    <h1 class="govuk-heading-l govuk-!-margin-bottom-2">
      Ingredients list -
      <span class="govuk-!-font-weight-regular opss-font-size--reduced-s">Responsible Persons</span>
    </h1>

    <p class="govuk-body opss-secondary-text">
      Ingredient <%= params[:ingredient_inci_name] %> is included in notifications -
      <span class="govuk-!-font-weight-bold opss-primary-text">submitted after 2 October 2022</span><a href="#october" class="govuk-link govuk-link--no-visited-state govuk-link--no-underline"><sup class="govuk-!-font-size-14">&ast;</sup></a>
      - by these Responsible Persons. From here you can view the notifications for each Responsible Person.
    </p>
  </div>
</div>

<div class="govuk-grid-row opss-full-height">
  <section class="govuk-grid-column-one-quarter govuk-!-padding-right-1 opss-full-height__col">
    <a href="#responsible_persons" class="govuk-skip-link opss-skip-link">
      Skip to the main content
    </a>
    <nav aria-label="Secondary">
      <%= render 'poison_centres/shared/secondary_navigation' %>
    </nav>
  </section>
  <section class="govuk-grid-column-three-quarters" id="responsible_persons">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-one-third opss-text-align-right">
        <div class="govuk-form-group opss-text-align-right">
          <form id="new_notification_search_form_sort" novalidate="novalidate" action="#" accept-charset="UTF-8" method="get">
            <input type="hidden" name="ingredient_inci_name" value="<%= params[:ingredient_inci_name] %>">
            <label class="govuk-label govuk-body-s" for="notification_search_form_sort_by">
              Order by
            </label>

            <select class="govuk-select govuk-!-margin-bottom-1" name="sort_by" id="notification_search_form_sort_by">
              <%= responsible_person_search_option("A - Z", "name_asc") %>
              <%= responsible_person_search_option("Z - A", "name_desc") %>
              <%= responsible_person_search_option("Most notifications", "most_notifications") %>
            </select>

            <button class="govuk-button opss-js-enabled-hidden">
              Order
            </button>
          </form>
        </div>
      </div>
    </div>
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
        <p class="govuk-body-s">
          There are currently <%= @responsible_persons.total_count %> Responsible Persons with active notifications (submitted after 2 October 2022) which include the ingredient <%= params[:ingredient_inci_name] %>.
        </p>
      </div>
    </div>
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full" role="region" aria-label="Search results">
        <div class="govuk-!-margin-top-5 opss-2-col-flow">
          <ul class="govuk-list govuk-list--bullet">
            <% @responsible_persons.each_with_index do |responsible_person, index| %>
              <li>
                <%= link_to responsible_person.name,
                  poison_centre_ingredients_responsible_person_notifications_path(
                    responsible_person_id: responsible_person.id,
                    ingredient_inci_name: params[:ingredient_inci_name],
                  ),
                  class: "govuk-link govuk-link--no-visited-state" %>
              </li>
            <% end %>
          </ul>
        </div>
        <%= paginate @responsible_persons, views_prefix: "pagination", nav_class: "opss-pagination-link--no-top-border" %>
      </div>
    </div>
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
        <p id="october" class="govuk-body govuk-!-font-size-14 govuk-!-margin-top-9 govuk-!-margin-bottom-0 opss-secondary-text opss-text-align-right">
          <sup>&ast;</sup>Notifications submitted before 3 October 2022 are not searchable for ingredients.<br>
          The ingredient may also feature in older notifications.
        </p>
      </div>
    </div>
  </section>
</div>

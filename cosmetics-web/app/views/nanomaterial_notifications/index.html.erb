<% content_for :page_title, "Nanomaterials" %>
<% content_for :after_header do %>
  <%= render "layouts/navbar" %>
<% end %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full govuk-!-margin-top-4">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <h1 class="govuk-heading-l govuk-!-margin-bottom-2" aria-describedby="nanomaterial-notifications-hint">
          Nanomaterials
        </h1>
      </div>
      <div class="govuk-grid-column-one-third govuk-!-margin-bottom-2">
        <%= link_to("Add a nanomaterial",
                    new_responsible_person_nanomaterial_path(@responsible_person),
                    class: "govuk-link govuk-link--no-visited-state govuk-!-font-size-19 opss-text-align-right opss-text-underline-offset") %>
      </div>
    </div>
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
        <p  id="nanomaterial-notifications-hint" class="govuk-hint govuk-!-width-two-thirds">
          These are your notified nanomaterials.
        </p>
      </div>
    </div>
  </div>
</div>

<% if @nanomaterial_notifications.present? %>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <a href="<%= responsible_person_nanomaterials_path(@responsible_person, :csv) %>" class="govuk-link govuk-link--no-visited-state govuk-!-font-size-14 opss-text-align-right" download="">
        <span class="opss-download-link-sm"></span>Download a <abbr title="Comma-Separated Values">CSV</abbr> file of notified nanomaterials
      </a>
    </div>
  </div>
<% end %>

<div class="govuk-grid-row">
  <section class="govuk-grid-column-full">
    <table id="table-items" class="govuk-table opss-table-items govuk-!-margin-top-5">
      <caption class="govuk-visually-hidden">
          Notified Nanomaterials data: 3 columns with each nanomaterial described across 2 rows within its own table body.
      </caption>

      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
            <th class="govuk-visually-hidden">&nbsp;</th>
            <th id="uknotified" scope="col" class="govuk-table__header"><abbr>UK</abbr> notified</th>
            <th id="eunotified" scope="col" class="govuk-table__header"><abbr>EU</abbr> notified</th>
            <th id="uknumber" scope="col" class="govuk-table__header"><abbr>UK</abbr> nanomaterial number</th>
        </tr>
      </thead>

      <% @nanomaterial_notifications.each_with_index do |notification, index| %>
        <%
          # Element index to start from 1 instead of 0
          item = "item-#{index + 1}"
          meta = "meta-#{index + 1}"
        %>
        <tbody class="govuk-table__body">
          <tr class="govuk-table__row">
            <th class="govuk-visually-hidden">
              Name
            </th>
            <th id="<%= item %>" colspan="3" scope="colgroup" class="govuk-table__header">
              <%= link_to(notification.name, nanomaterial_path(notification), class: "govuk-link govuk-link--no-visited-state") %>
            </th>
          </tr>
          <tr class="govuk-table__row">
            <th headers="<%= item %>" id="<%= meta %>" class="govuk-visually-hidden">
              Metadata
            </th>
            <td headers="uknotified <%= item %> <%= meta %>" class="govuk-table__cell">
              <%= display_full_month_date notification.submitted_at %>
            </td>
            <td headers="eunotified <%= item %> <%= meta %>" class="govuk-table__cell">
              <%= if notification.eu_notified
                    display_full_month_date notification.notified_to_eu_on
                  else
                    "No"
                  end %>
            </td>
            <td headers="uknumber <%= item %> <%= meta %>" class="govuk-table__cell">
              <abbr>UKN</abbr>-<%= notification.id %>
            </td>
          </tr>
        </tbody>
      <% end %>
      <% if @nanomaterial_notifications.size >= 12 %>
        <tfoot class="govuk-table__head">
          <tr class="govuk-table__row">
            <th class="govuk-visually-hidden">&nbsp;</th>
            <th scope="col" class="govuk-table__header"><abbr>UK</abbr> notified</abbr></th>
            <th scope="col" class="govuk-table__header"><abbr>EU</abbr> notified</abbr></th>
            <th scope="col" class="govuk-table__header"><abbr>UK</abbr> nanomaterial number</th>
          </tr>
        </tfoot>
      <% end %>
    </table>
    <%= paginate @nanomaterial_notifications, views_prefix: 'pagination' %>
  </section>
</div>
